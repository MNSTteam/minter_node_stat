<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Minter Validators rating</title>

	<meta name="viewport" content="width=device-width, initial-scale=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, initial-scale=0, maximum-scale=0, user-scalable=no">
    <link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.png">

<script src="_config.js"></script>
<script src="jquery.min.js"></script>
<script src="winblur.js"></script>
<script src="clipboard/dist/clipboard.min.js"></script>
<script src="Chart.bundle.min.js"></script>
<script type="text/javascript" src="__jquery.tablesorter/jquery.tablesorter.js"></script>


<style type="text/css">
@font-face{
font-family:Ubuntu;
font-style:normal;
font-weight:400;
src:local("Ubuntu Regular"),
local("Ubuntu-Regular"),
url(fonts/ubuntu-v11-cyrillic_latin-regular.4f9cb44.woff2) format("woff2"),
url(fonts/ubuntu-v11-cyrillic_latin-regular.b3d1002.woff) format("woff")
}
@font-face{
font-family:Ubuntu;
font-style:normal;
font-weight:700;
src:local("Ubuntu Bold"),
local("Ubuntu-Bold"),
url(fonts/ubuntu-v11-cyrillic_latin-700.1878bde.woff2) format("woff2"),
url(fonts/ubuntu-v11-cyrillic_latin-700.0f3b6eb.woff) format("woff")}*,
:after,:before{box-sizing:border-box
}

body{background:#f6f6f6;color:#333;font-family:Ubuntu,SimSun,PingFang SC,sans-serif;font-size:14px;font-weight:400;height:100%;line-height:1.4;margin:0}
.clear {
	float:none;
	clear:both;
	width:100%;
	font-size:1px;
}
.head {
    background: #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,.1);
    width: 100%;
}
.header__logo-image {
    font-size: 0;
    margin-left: 2px;
    margin-right: 20px;
    float: left;
}
.header__logo-text {
    font-size: 26px;
    line-height: 32px;
}
#rating tr th, #rating tr td {
	font-size: 15px;
	border-left:1px #e5e5e5 solid; 
}
#rating tr th {
	padding-bottom: 10px;
	font-weight: bold;
	border-bottom:1px solid #e5e5e5;
	text-align: center;
}
#rating th.header { 
    background-image: url(i/arrows.svg); 
    cursor: pointer; 
    font-weight: bold; 
    background-repeat: no-repeat; 
    background-position: 5px 7px; 
    padding-left: 17px;
} 
#rating th.headerSortUp { 
    background-image: url(i/arrow_up.svg); 
    color: #000; 
} 
#rating th.headerSortDown { 
    background-image: url(i/arrow_down.svg); 
    color: #000; 
} 
#rating tr th {
	color: #666;
}
#rating tr td {
	padding:10px 7px;
	text-align: center;
}
.nobrdl {
	border-left: none!important;
}
.even {
	background-color: #f0f0f0;
}
.odd {
	background-color: #fff;
}

.active {
	background-color: #cf5c2c!important;
	color:#fff;
	cursor: pointer;
}
.active td small {
	color:#fff!important;
}
.box_window{
  position:fixed;
  z-index:1199;
  background: #fff;
  display:none;
  padding:20px;
  -moz-border-radius: 10px; 
  border-radius: 10px; 
  	top: 50px;
    bottom: 50px;
    
    width:900px; /*Ширина блока*/
    margin:0 auto;
    left:50%;
    margin-left:-450px; /*Смещаем блок на половину всей ширины влево*/
    
    box-shadow: 0 2px 5px rgba(0,0,0,.7);
}
.box_window_in {
  overflow-y:scroll;
  position:absolute;
  	top: 20px;
    right: 20px;
    bottom: 20px;
    left: 20px;
    margin: auto;
    overflow-y:scroll;
}
.box_title {
  position: absolute;
  left: 0px;
  top: -30px;
  left: 25px;
  color: #000;
  text-shadow: 1px 1px 1px #aeaeae!important;
  font-weight: bold;
  font-size: 18px;
  z-index: 9999;
  background: url(i/copy.svg) center right no-repeat;
  background-size: 18px 18px;
  padding-right: 25px;
  cursor: pointer;
}
.bw_close{
  position:absolute;
  top: -25px;
  font-size: 10px;
  color: #fff;
  right:0px;
  cursor:pointer;
  z-index: 2;
}
.mask{
  position:fixed;
  background:rgba(0, 0, 0, 0.38);
  display:none;
  height:100%;
  width: 100%;
  z-index:10;
}
.to_blur.blur {
 -webkit-filter: blur(5px);
 -moz-filter: blur(5px);
 -o-filter: blur(5px);
 -ms-filter: blur(5px);
 filter: blur(5px);
}


.info3 {
	width: 33.3%;
	float: left;
}
.info2 {
	width: 66.6%;
	float: left;
}
.infopad {
	padding-right: 30px;
	padding-bottom: 30px;
}
.infopad div.inbl {
	border: 1px #f0f0f0 solid;
	padding: 10px;
	min-height: 300px;
}
.ccHD {
	font-size:16px; text-align:center; padding-bottom:10px; font-weight:bold;
	border-bottom: 1px #f0f0f0 solid;
	margin-bottom: 10px;
}
.colBlue {
	color:#6f91d4!important;
}
.colRed {
	color:#cf5c2c!important;
}
</style>
</head>

<body>
<div class="to_blur">
<div class="head">
	<div style="width:100%" align="center">
		<div style="width:1000px; padding:20px 0; text-align:left">
			<img alt="Minter" class="header__logo-image" height="36" src="i/minter-logo-circle.svg" width="36">
			<div class="header__logo-text">Node explorer</div>
		</div>
	</div>
</div>

<div style="width:100%" align="center">
<div style="width:1000px; text-align:left; background-color:#FFF; margin-top:20px">
<div style="padding:10px 10px">
<table width="100%" border="0" cellpadding="3" cellspacing="0" id="rating">
	<thead>
	<tr>
	<th nowrap="nowrap" class="nobrdl">Rang</th>
	<th nowrap="nowrap" align="left" style="text-align:left; padding-left:30px; background-position: 15px 7px;">Public key</th>
	<th nowrap="nowrap">Comission</th>
	<th nowrap="nowrap" class="{sorter: 'integer'}" style="text-align:left; padding-left:30px; background-position: 15px 7px;">Total Stake (d24)</th>
	<th nowrap="nowrap">Node status</th>
	<th nowrap="nowrap">Delegators (d24)</th>
	<th nowrap="nowrap">Uptime</th>
	<th nowrap="nowrap">Age</th>
	</tr>
	</thead>
	
	
	<tbody>
	
	</tbody>
</table>
<div align="center" style="text-align:center" id="loader"><img src="i/loaderB.svg" /></div>
</div>
</div>
</div>

</div>

<a href="javascript:void(0)" id="copyAl" class="popbutton" data-window="copyAlert" style="display:none">&nbsp;</a>
<a href="javascript:void(0)" id="loaderL" class="popbutton" data-window="loaderD" style="display:none">&nbsp;</a>
<a href="javascript:void(0)" id="showCard" class="popbutton" data-window="validatorCard" style="display:none">&nbsp;</a>

<div style="display:none" id="copy_text"></div>

<div id="copyAlert" class="popwindow" data-title="Copied Public Key MonsterNode"><script>document.writeln(myPKEY)</script></div>

<div id="loaderD" class="popwindow" data-title="Loading..." style="background: url(i/loaderB.svg) center center no-repeat;">

</div>


<div id="validatorCard" class="popwindow" data-title="Node" style="overflow:show">
</div>



<script>

function addCommas(nStr, del)
{
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + del + '$2');
    }
    return x1 + x2;
}

var timeparts = [
   {name: 'millenni', div: 31556736000, p: 'a', s: 'um'},
   {name: 'centur', div: 3155673600, p: 'ies', s: 'y'},
   {name: 'decade', div: 315567360},
   {name: 'y', div: 31556736},
   {name: 'm', div: 2629728},
   {name: 'd', div: 86400},
   {name: 'h', div: 3600},
   {name: 'm', div: 60},
   {name: 's', div: 1}
];

function timeAgoNaive2(comparisonDate) {
	var ttm=comparisonDate.getTime();
   var i = 0,
      parts = [],
      interval = Math.floor((new Date().getTime() - ttm) / 1000);
      iinn=interval;
   for ( ; interval > 0; i += 1) {
      value = Math.floor(interval / timeparts[i].div);
      interval = interval - (value * timeparts[i].div);
      if (value) {
         parts.push(value + '' + timeparts[i].name +' '+ (value !== 1 ? timeparts[i].p || '' : timeparts[i].s || ''));
      }
   }
   if (parts.length === 0) { return 'now'; }
   ret=parts[0]+parts[1];
   return ret;
}

function showLoadCard(el) {
	$('#loaderD').parent().fadeOut("slow");
	document.getElementById('showCard').click();
}

$(document).ready(function() 
    { 
       
        $.getJSON(API_ENDPOINT+"/api.php", function(data) { 
             // append the "ajax'd" data to the table body 
             //$("#rating tbody").append(html);
             //console.log(data); 
             
          var items = [];
          var GLOBC=1;
          var cls='even';
  			$.each( data['data'], function( key, val ) {
   			 $.each( val, function( k, v ) {
   			 	$.each( v, function( n, c ) {
   			 		//console.log(c);
   			 		var ord = (GLOBC/2);
   			 		if((''+ord).indexOf('.')==-1) { cls='odd'; } else { cls='even'; }
   			 		GLOBC++;
   			 		PKEY = c['PKEY'].substr(0, 7)+'...'+c['PKEY'].substr(-7);
   			 		if(c['PKEY']==myPKEY) {
   			 			PKEY = '<strong>'+PKEY+'</strong>';
   			 		}
   			 		uptime=c['uptime'];
   			 		uptime=(''+uptime).substr(0, 4)+'%'
   			 		if(c['realtimeTextStatus']=='Candidate') {
   			 			uptime='-';
   			 			c['uptime']=0;
   			 		}
   			 		STAKE = c['total_stake']/1000000000000000000;
   			 		c['total_stake']=addCommas(Math.round(STAKE),' ');
   			 		
   			 		//console.log(new Date(c['create_time']['tm']*1000));
   			 		
   			 		age=timeAgoNaive2(new Date(c['create_time']['tm']*1000));
   			 		lastAct = timeAgoNaive2(new Date(c['nodeLastActivity']*1000));
   			 		   			 		
   			 		   			 		
   			 		   			 		
   			 		   			 		
   			 		items.push( "<tr class='"+cls+" trShowCand'><td style='font-weight:bold; text-align:center'  class='nobrdl'>"+c['rank']+"</td><td class='pubkey' data-sort='"+c['PKEY']+"'>"+PKEY+"</td><td style='font-weight:bold; text-align:center'>"+c['commission']+"%</td><td data-sort='"+STAKE+"'>"+c['total_stake']+" "+data['baseCoin']+(data['newData']['stakes'][c['PKEY']]?" <small style='color:#7e7e7e'>(+"+Math.round(data['newData']['stakes'][c['PKEY']])+")</small>":'')+"</td><td"+(c['realtimeTextStatus']=='Candidate'?' style="color:#7e7e7e"':'')+">"+c['realtimeTextStatus']+"</td><td data-sort='"+c['delegants']+"'>"+c['delegants']+(data['newData']['delegators'][c['PKEY']]?" <small style='color:#7e7e7e'>(+"+Math.round(data['newData']['delegators'][c['PKEY']])+")</small>":'')+"</td><td data-sort='"+c['uptime']+"' style='font-weight:bold; text-align:center'>"+uptime+"</td><td data-sort='"+c['create_time']['tm']+"'>"+age+"</td></tr>" );
   			 	});
   			 });
  			});
			
			$("#rating tbody").append(items.join( " " ));
			$("#loader").hide();
            // let the plugin know that we made a update 
            $("#rating").trigger("update"); 
            // set sorting column and direction, this will sort on the first and third column 
            var sorting = [[4,1], [0,0]]; 
            // sort on the first column 
            $("#rating").tablesorter(
            	{ 
        			textExtraction: function(node) { 
            		// extract data from markup and return it  
            		if(node.getAttribute('data-sort')) {
            			return node.getAttribute('data-sort'); 
            		} else {
            			return node.innerText;
            		}
        		},
            	widgets: ['zebra'] 
    		});
            $("#rating").trigger("sorton",[sorting]); 
            
                    $("#rating tr").mouseenter(function() {
    					if($(this).parent().prop("tagName")!='THEAD' && $(this).parent().prop("tagName")!='thead') { 
    						$(this).addClass("active");
    					}
  					})
  					.mouseleave(function() {
    					if($(this).parent().prop("tagName")!='THEAD' && $(this).parent().prop("tagName")!='thead') {
    						$(this).removeClass("active");
    					}
  					});
  					
  					  $('.trShowCand').click(function() {
  						var PK = $(this).find('.pubkey')[0].getAttribute('data-sort');
  						$('#loaderL').click();
  						$.get(API_ENDPOINT+"/candidate_card.php?pk="+PK, function(data) { 
  							$('#validatorCard').attr('data-title',PK);
  							$('#validatorCard').html(data);
  							$('#validatorCard').parent().find('.box_title')[0].innerHTML=PK;
  							$('#validatorCard').siblings('.box_title').attr('data-clipboard-text',PK);
  							$('#copy_text').html(PK);
  							showLoadCard($(this));
  						});
  						
					  });

        });
        
							
							var clipboard2 = new ClipboardJS('.box_title');
  							clipboard2.on('success', function(e) {

								alert('Node Public Key copied!');
    							e.clearSelection();
							});     
     
     var clipboard = new ClipboardJS('.btn');

clipboard.on('success', function(e) {

	document.getElementById('copyAl').click();
    e.clearSelection();
});

clipboard.on('error', function(e) {
    console.error('Action:', e.action);
    console.error('Trigger:', e.trigger);
});
     
        
    } 
); 
</script>

</body>
</html>